<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>[achtung.live] ‚Äì Datenschutzanalyse und Korrektur (inkl. Emojis)</title>
  <style>
    :root {
      --primary: #c60000;
      --accent: #0a1a2f;
      --bg: #ffffff;
      --link: #0044cc;
      --light: #f9f9f9;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--accent);
      padding: 20px;
      margin: auto;
      max-width: 800px;
    }

    h1 {
      font-size: 1.6em;
      margin-bottom: 1em;
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 12px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      resize: vertical;
    }

    button {
      background-color: var(--primary);
      color: white;
      padding: 14px;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      margin-top: 20px;
      cursor: pointer;
      width: 100%;
      touch-action: manipulation;
    }

    label {
      font-size: 1rem;
      display: block;
      margin-top: 1em;
    }

    input[type="checkbox"] {
      transform: scale(1.4);
      margin-right: 10px;
    }

    #loader {
      margin-top: 10px;
      font-weight: bold;
      color: var(--accent);
    }

    #resultBox {
      margin-top: 25px;
      padding: 20px;
      background: var(--light);
      border-left: 4px solid var(--primary);
      border-radius: 5px;
      line-height: 1.6;
    }

    #resultBox strong {
      color: var(--primary);
    }

    #resultBox a {
      color: var(--link);
      text-decoration: underline;
    }

    .flag-select {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }

    .flag-select img {
      width: 28px;
      height: 20px;
      margin-right: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 4px;
    }

    .flag-select img.active {
      border-color: var(--primary);
    }

    @media (max-width: 600px) {
      body {
        padding: 15px;
      }

      h1 {
        font-size: 1.4em;
      }

      button {
        font-size: 1rem;
        padding: 12px;
      }

      textarea {
        height: 100px;
      }

      .flag-select img {
        width: 26px;
        height: 18px;
      }
    }
  </style>
</head>
<body>
  <h1>[achtung.live] ‚Äì Datenschutzanalyse und Korrektur (inkl. Emojis)</h1>

  <label for="text">üîé Zu analysierender Text:</label>
  <textarea id="text" placeholder="Gib deinen Text hier ein‚Ä¶"></textarea>

  <div class="flag-select">
    <img src="https://flagcdn.com/w40/de.png" alt="Deutsch" onclick="setLanguage('de')" id="flag-de" />
    <img src="https://flagcdn.com/w40/gb.png" alt="English" onclick="setLanguage('en')" id="flag-en" />
    <img src="https://flagcdn.com/w40/fr.png" alt="Fran√ßais" onclick="setLanguage('fr')" id="flag-fr" />
  </div>

  <input type="hidden" id="language" value="de" />

  <label>
    <input type="checkbox" id="consent">
    Ich stimme der Verarbeitung meiner Eingabe zum Zweck der Analyse gem√§√ü <a href="#">Datenschutzerkl√§rung</a> zu.
  </label>

  <p id="loader"></p>
  <div id="result"></div>

  <script>
    let debounceTimer;

    function setLanguage(lang) {
      document.getElementById("language").value = lang;
      document.querySelectorAll(".flag-select img").forEach(img => img.classList.remove("active"));
      document.getElementById("flag-" + lang).classList.add("active");
    }

    function analyzeText() {
      const text = document.getElementById("text").value.trim();
      const consent = document.getElementById("consent").checked;
      const loader = document.getElementById("loader");
      const result = document.getElementById("result");

      if (!consent) {
        loader.innerText = "‚ùó Bitte der Analyse zustimmen.";
        result.innerHTML = "";
        return;
      }

      if (!text) {
        loader.innerText = "";
        result.innerHTML = "";
        return;
      }

      loader.innerText = "Analyse l√§uft, Optimierung wird erstellt...";
      result.innerHTML = "";

      fetch("https://web-production-f8648.up.railway.app/debug-gpt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          text: text,
          language: document.getElementById("language").value
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          loader.innerText = "";
          if (data.suggestions) {
            result.innerHTML = "<div id='resultBox'>" + data.suggestions.join("<br><br>") + "</div>";
          } else {
            result.innerHTML = "<div id='resultBox'>‚ö†Ô∏è Keine Vorschl√§ge gefunden.<br><br><strong>GPT-Rohantwort:</strong><br>" + (data.gpt_raw || "Keine Antwort erhalten") + "</div>";
          }
        })
        .catch((err) => {
          loader.innerText = "‚ùå Fehler: " + err.message;
        });
    }

    document.getElementById("text").addEventListener("input", () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(analyzeText, 1200); // Analyse nach 1.2 Sekunden Inaktivit√§t
    });
  </script>
</body>
</html>
